!function(){function e(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}var i=function t(){"use strict";e(this,t)};i.windowWidth=400,i.windowHeight=400,i.framesPerSecond=120,i.numInputs=4,i.numHidden=1,i.neuronsPerHiddenLayer=6,i.numOutputs=2,i.activationResponse=1,i.bias=-1,i.maxTurnRate=.3,i.maxSpeed=2,i.sweeperScale=5,i.numMines=40,i.numSweepers=30,i.numTicks=2e3,i.mineScale=2,i.crossoverRate=.7,i.mutationRate=.05,i.maxPerturbation=.3,i.numElite=4,i.numCopiesElite=1;var s=function(){"use strict";function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.framesPerSecond;e(this,t),this.currentTime=0,this.lastTime=0,this.nextTime=0,this.frameTime=0,this.perfCountFreq=1e3,this.timeElapsed=0,this.fps=0,n&&(this.fps=n,this.frameTime=this.perfCountFreq/this.fps,this.lastTime=new Date().getTime(),this.currentTime=this.lastTime,this.nextTime=this.currentTime+this.frameTime)}return n(t,[{key:"start",value:function(){this.nextTime=new Date().getTime()+this.frameTime}},{key:"readyForNextFrame",value:function(){return this.currentTime=new Date().getTime(),this.currentTime>this.nextTime&&(this.timeElapsed=this.currentTime-this.lastTime,this.lastTime=this.currentTime,this.nextTime=this.currentTime+this.frameTime,!0)}},{key:"getTimeElapsed",value:function(){return this.currentTime=new Date().getTime(),this.timeElapsed=this.currentTime-this.lastTime,this.lastTime=this.currentTime,this.timeElapsed}}]),t}();function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function o(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=function(){"use strict";function t(n,i){e(this,t),this.x=n,this.y=i}return n(t,[{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"multiply",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e,this.y/=e,this}},{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){return this.divide(this.magnitude())}}],[{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"sign",value:function(e,t){return e.y*t.x>e.x*t.y?1:-1}}]),t}(),a=0,u=function(){"use strict";function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e(this,t),this.vecWeights=[],this.dFitness=0,this.name=s||"Genome_".concat(a++),n.length<1?this.dFitness=0:n.length>0&&(this.vecWeights=o(n),this.dFitness=i)}return n(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}}],[{key:"sort",value:function(e,t){return e.dFitness-t.dFitness}}]),t}(),c=function(){"use strict";function t(n,i,s,r){e(this,t),this.vecPop=[],this.iPopSize=n,this.dMutationRate=i,this.dCrossoverRate=s,this.iChromoLength=r,this.medianFitness=0,this.dTotalFitness=0,this.cGeneration=0,this.iFittestGenome=0,this.dBestFitness=0,this.dWorstFitness=99999999,this.dAverageFitness=0;for(var o=0;o<this.iPopSize;o++){this.vecPop.push(new u([],0));for(var h=0;h<this.iChromoLength;h++)this.vecPop[o].vecWeights.push(Math.random())}}return n(t,[{key:"mutate",value:function(e){for(var t=[],n=0;n<e.length;n++)Math.random()<this.dMutationRate?t[n]=e[n]+(Math.random()-Math.random())*i.maxPerturbation:t[n]=e[n];return t}},{key:"getChromoRoulette",value:function(){for(var e,t=Math.random()*this.dTotalFitness,n=0,i=0;i<this.vecPop.length;i++)if((n+=this.vecPop[i].dFitness)>=t){e=this.vecPop[i];break}if(void 0===e)throw Error("not a genome!");return new u(o(e.vecWeights),e.dFitness,e.getName())}},{key:"crossover",value:function(e,t,n,i){if(Math.random()>this.dCrossoverRate||e.join("")===t.join("")){e.forEach(function(e){return n.push(e)}),t.forEach(function(e){return i.push(e)});return}for(var s=Math.round(Math.random()*(e.length-1)),r=0;r<s;r++)n.push(e[r]),i.push(t[r]);for(var o=s;o<e.length;o++)n.push(t[o]),i.push(e[o])}},{key:"epoch",value:function(e){console.log("this.vecPop: ".concat(JSON.stringify(this.vecPop.map(function(e){return e.getName()})))),console.log("oldPop: ".concat(JSON.stringify(e.map(function(e){return e.getName()})))),this.vecPop=e,this.reset(),this.vecPop.sort(u.sort),this.calculateBestWorstAvTot();var t=[];for(i.numCopiesElite*i.numElite%2?console.log("error: numCopiesElite * numElite is not even"):this.grabNBest(i.numElite,i.numCopiesElite,t);t.length<this.iPopSize;){var n=this.getChromoRoulette(),s=this.getChromoRoulette(),r=[],h=[];this.crossover(n.vecWeights,s.vecWeights,r,h);var a=this.mutate(r),c=this.mutate(h);t.push(new u(o(a),0)),t.push(new u(o(c),0))}this.vecPop=t,e.length=0,e.push.apply(e,o(this.vecPop))}},{key:"grabNBest",value:function(e,t,n){for(var i=e;i--;)for(var s=0;s<t;s++)n.push(new u(o(this.vecPop[this.vecPop.length-1-i].vecWeights),0,this.vecPop[this.vecPop.length-1-i].getName()))}},{key:"calculateBestWorstAvTot",value:function(){this.dTotalFitness=0;var e=0,t=9999999;this.vecPop.sort(u.sort),this.medianFitness=this.vecPop[Math.floor(this.vecPop.length/2)].dFitness;for(var n=0;n<this.vecPop.length;n++)this.vecPop[n].dFitness>e&&(e=this.vecPop[n].dFitness,this.iFittestGenome=n,this.dBestFitness=e),this.vecPop[n].dFitness<t&&(t=this.vecPop[n].dFitness,this.dWorstFitness=t),this.dTotalFitness+=this.vecPop[n].dFitness;this.dAverageFitness=this.dTotalFitness/this.iPopSize}},{key:"reset",value:function(){this.dTotalFitness=0,this.dBestFitness=0,this.dWorstFitness=9999999,this.dAverageFitness=0,this.medianFitness=0}},{key:"getChromos",value:function(){return this.vecPop}},{key:"getGeneration",value:function(){return this.cGeneration}},{key:"averageFitness",value:function(){return this.dTotalFitness/this.iPopSize}},{key:"bestFitness",value:function(){return this.dBestFitness}},{key:"getMedianFitness",value:function(){return this.medianFitness}}]),t}(),l=function t(n){"use strict";e(this,t),this.vecWeight=[],this.numInputs=n;for(var i=0;i<n+1;++i)this.vecWeight.push(Math.random())},d=function t(n,i){"use strict";e(this,t),this.vecNeurons=[],this.numNeurons=n,this.numInputsPerNeuron=i;for(var s=0;s<n;s++)this.vecNeurons.push(new l(this.numInputsPerNeuron))},v=function(){"use strict";function t(){e(this,t),this.neuronLayers=[],this.numInputs=i.numInputs,this.numOutputs=i.numOutputs,this.numHiddenLayers=i.numHidden,this.neuronsPerHiddenLayer=i.neuronsPerHiddenLayer,this.createNet()}return n(t,[{key:"createNet",value:function(){if(this.numHiddenLayers>0){this.neuronLayers.push(new d(this.neuronsPerHiddenLayer,this.numInputs));for(var e=0;e<this.numHiddenLayers-1;e++)this.neuronLayers.push(new d(this.neuronsPerHiddenLayer,this.neuronsPerHiddenLayer));this.neuronLayers.push(new d(this.numOutputs,this.numInputs))}else this.neuronLayers.push(new d(this.numOutputs,this.numInputs))}},{key:"getNumberOfWeights",value:function(){for(var e=0,t=0;t<this.numHiddenLayers;t++)for(var n=0;n<this.neuronLayers[t].numNeurons;n++)for(var i=0;i<this.neuronLayers[t].vecNeurons[n].numInputs;i++)e++;return e}},{key:"getWeights",value:function(){for(var e=[],t=0;t<this.numHiddenLayers;t++)for(var n=0;n<this.neuronLayers[t].numNeurons;n++)for(var i=0;i<this.neuronLayers[t].vecNeurons[n].numInputs;i++)e.push(this.neuronLayers[t].vecNeurons[n].vecWeight[i]);return e}},{key:"putWeights",value:function(e){for(var t=0,n=0;n<this.numHiddenLayers;n++)if(this.neuronLayers.length>0)for(var i=0;i<this.neuronLayers[n].numNeurons;i++)for(var s=0;s<this.neuronLayers[n].vecNeurons[i].numInputs;s++)this.neuronLayers[n].vecNeurons[i].vecWeight[s]=e[t++]}},{key:"update",value:function(e){var t=o(e),n=[],s=0;if(t.length!==this.numInputs)return console.log("Error wrong number of inputs, expected ".concat(this.numInputs," got ").concat(t.length)),n;for(var r=0;r<this.numHiddenLayers+1;r++)if(r>0&&(t=o(n)),n.length=0,s=0,this.neuronLayers.length>0)for(var h=0;h<this.neuronLayers[r].numNeurons;h++){var a=0;this.numInputs=this.neuronLayers[r].vecNeurons[h].numInputs;for(var u=0;u<this.numInputs-1;u++)a+=this.neuronLayers[r].vecNeurons[h].vecWeight[u]*t[s++];a+=this.neuronLayers[r].vecNeurons[h].vecWeight[this.numInputs-1]*i.bias,n.push(this.sigmoid(a,i.activationResponse)),s=0}return n}},{key:"sigmoid",value:function(e,t){return 1/(1+Math.exp(-1*e/t))}}]),t}(),m=function(){"use strict";function t(){e(this,t),this._11=1,this._12=0,this._13=0,this._21=0,this._22=1,this._23=0,this._31=0,this._32=0,this._33=1}return n(t,[{key:"consumeMatrix",value:function(e){this._11=e._11,this._12=e._12,this._13=e._13,this._21=e._21,this._22=e._22,this._23=e._23,this._31=e._31,this._32=e._32,this._33=e._33}},{key:"TwoDimensionalMatrixMultiply",value:function(e){var n=new t;n._11=this._11*e._11+this._12*e._21+this._13*e._31,n._12=this._11*e._12+this._12*e._22+this._13*e._32,n._13=this._11*e._13+this._12*e._23+this._13*e._33,n._21=this._21*e._11+this._22*e._21+this._23*e._31,n._22=this._21*e._12+this._22*e._22+this._23*e._32,n._23=this._21*e._13+this._22*e._23+this._23*e._33,n._31=this._31*e._11+this._32*e._21+this._33*e._31,n._32=this._31*e._12+this._32*e._22+this._33*e._32,n._33=this._31*e._13+this._32*e._23+this._33*e._33,this.consumeMatrix(n)}},{key:"createIdentity",value:function(){var e=new t;return e._11=1,e._22=1,e._33=1,e._12=0,e._13=0,e._21=0,e._23=0,e._31=0,e._32=0,e}},{key:"translate",value:function(e,t){var n=this.createIdentity();n._31=e,n._32=t,this.TwoDimensionalMatrixMultiply(n)}},{key:"scale",value:function(e,t){var n=this.createIdentity();n._11=e,n._22=t,this.TwoDimensionalMatrixMultiply(n)}},{key:"rotate",value:function(e){var t=this.createIdentity(),n=Math.sin(e),i=Math.cos(e);t._11=i,t._12=n,t._21=-1*n,t._22=i,this.TwoDimensionalMatrixMultiply(t)}},{key:"transformPoints",value:function(e){for(var t=0;t<e.length;t++){var n=this._11*e[t].x+this._21*e[t].y+this._31,i=this._12*e[t].x+this._22*e[t].y+this._32;e[t].x=n,e[t].y=i}}},{key:"reportMatrix",value:function(){return"\n        ".concat(this._11," ").concat(this._12," ").concat(this._13,"\n        ").concat(this._21," ").concat(this._22," ").concat(this._23,"\n        ").concat(this._31," ").concat(this._32," ").concat(this._33)}}]),t}(),p=function t(){"use strict";var n=this;e(this,t),this.getNumberOfWeights=function(){return n.brain.getNumberOfWeights()},this.reset=function(){n.position=new h(Math.random()*i.windowWidth,Math.random()*i.windowHeight),n.rotation=2*Math.random()*Math.PI,n.minesFound=0},this.worldTransform=function(e){var t=new m;t.scale(n.scale,n.scale),t.rotate(n.rotation%(2*Math.PI)),t.translate(n.position.x,n.position.y),t.transformPoints(e)},this.update=function(e){var t=[],s=n.getClosestMine(e),r=new h(s.x,s.y);r.normalize(),t.push(r.x),t.push(r.y),t.push(n.lookAt.x),t.push(n.lookAt.y),n.closestMine=e.map(function(e){return"".concat(e.x,",").concat(e.y)}).findIndex(function(e){return e==="".concat(s.x,",").concat(s.y)});var o=n.brain.update(t);if(o.length!==i.numOutputs)throw Error("Outputs length does not match number of outputs ".concat(o.length,", ").concat(i.numOutputs));n.leftTrack=o[0],n.rightTrack=o[1];var a=n.leftTrack-n.rightTrack;return a=Math.min(Math.max(a,-i.maxTurnRate),i.maxTurnRate),n.rotation+=a,n.velocity=n.leftTrack+n.rightTrack,n.lookAt.x=-1*Math.sin(n.rotation),n.lookAt.y=Math.cos(n.rotation),n.position.add(n.lookAt.multiply(n.velocity)),n.position.x<0&&(n.position.x=n.position.x%i.windowWidth+i.windowWidth),n.position.x>i.windowWidth&&(n.position.x=n.position.x%i.windowWidth),n.position.y<0&&(n.position.y=n.position.y%i.windowHeight+i.windowHeight),n.position.y>i.windowHeight&&(n.position.y=n.position.y%i.windowHeight),!0},this.getClosestMine=function(e){for(var t=0,i=Number.MAX_VALUE,s=0,r=0;r<e.length;r++)(s=new h(n.position.x,n.position.y).subtract(e[r]).magnitude())<i&&(i=s,t=r);return e[t]},this.incrementMinesFound=function(){n.minesFound++},this.getMinesFound=function(){return n.minesFound},this.getPosition=function(){return new h(n.position.x,n.position.y)},this.checkForMine=function(e,t){return n.getPosition().subtract(e[n.closestMine]).magnitude()<t+5?n.closestMine:-1},this.incrementFitness=function(){n.incrementMinesFound()},this.fitness=function(){return n.minesFound},this.putWeights=function(e){n.brain.putWeights(o(e))},this.brain=new v,this.position=new h(Math.random()*i.windowWidth,Math.random()*i.windowHeight),this.rotation=2*Math.random()*Math.PI,this.lookAt=new h(-1*Math.sin(this.rotation),Math.cos(this.rotation)),this.velocity=0,this.minesFound=0,this.scale=i.sweeperScale,this.closestMine=0,this.leftTrack=.16,this.rightTrack=.16},f=Array(16);f[0]=new h(-1,-1),f[1]=new h(-1,1),f[2]=new h(-.5,1),f[3]=new h(-.5,-1),f[4]=new h(.5,-1),f[5]=new h(1,-1),f[6]=new h(1,1),f[7]=new h(.5,1),f[8]=new h(-.5,-.5),f[9]=new h(.5,-.5),f[10]=new h(-.5,.5),f[11]=new h(-.25,.5),f[12]=new h(-.25,1.75),f[13]=new h(.25,1.75),f[14]=new h(.25,.5),f[15]=new h(.5,.5);var g=[,,,,];g[0]=new h(-1,-1),g[1]=new h(-1,1),g[2]=new h(1,1),g[3]=new h(1,-1);var w=function(){"use strict";function t(n,s){var r=this;e(this,t),this.vecMines=[],this.sweeperVB=[],this.mineVB=[],this.fastRender=!1,this.iTick=0,this.iGeneration=0,this.vecAvFitness=[],this.vecBestFitness=[],this.vecMedianFitness=[],this.update=function(){return r.iTick++<i.numTicks?r.vecSweepers.forEach(function(e,t){if(!r.vecSweepers[t].update(r.vecMines))return console.log("error in update, wrong amount of NN inputs"),!1;var n=r.vecSweepers[t].checkForMine(r.vecMines,i.mineScale);n>=0&&(r.vecSweepers[t].incrementFitness(),r.vecMines[n]=new h(Math.random()*r.canvas.width,Math.random()*r.canvas.height)),r.vecThePopulation[t].dFitness=r.vecSweepers[t].fitness()}):(r.vecAvFitness.push(r.geneticAlgorithm.averageFitness()),r.vecBestFitness.push(r.geneticAlgorithm.bestFitness()),r.vecMedianFitness.push(r.geneticAlgorithm.getMedianFitness()),r.iGeneration++,r.iTick=0,r.geneticAlgorithm.epoch(r.vecThePopulation),console.log("Generation ".concat(r.iGeneration," Genome Names:\n	").concat(r.vecThePopulation.map(function(e){return e.getName()}).join("\n	"))),r.vecSweepers.forEach(function(e,t){r.vecSweepers[t].putWeights(o(r.vecThePopulation[t].vecWeights)),r.vecSweepers[t].reset()})),!0};var a=document.createElement("label");a.innerText="Fast Render";var u=document.createElement("input");u.type="checkbox",u.checked=!1,u.addEventListener("change",function(e){e.target.checked?r.fastRender=!0:r.fastRender=!1}),a.appendChild(u);var l=document.createElement("label");l.innerText="Pause";var d=document.createElement("input");d.type="checkbox",d.checked=!1,d.addEventListener("change",function(e){e.target.checked?r.pause():r.unPause()}),l.appendChild(d),this.pauseSwitch=d,this.pause=n,this.unPause=s;var v=document.createElement("canvas");v.width=i.windowWidth,v.height=i.windowHeight,setTimeout(function(){document.body.appendChild(v),document.body.appendChild(l),document.body.appendChild(a)},0),this.canvas=v,this.numberOfSweepers=i.numSweepers,this.numberOfMines=i.numMines,this.vecThePopulation=[],this.vecSweepers=Array(this.numberOfSweepers).fill("").map(function(){return new p}),this.vecMines=Array(this.numberOfMines).fill("").map(function(){return new h(Math.random()*v.width,Math.random()*v.height)}),this.numberOfWeightsInNN=this.vecSweepers[0].getNumberOfWeights(),this.geneticAlgorithm=new c(this.numberOfSweepers,i.mutationRate,i.crossoverRate,this.numberOfWeightsInNN),this.vecThePopulation=this.geneticAlgorithm.getChromos(),this.vecSweepers.forEach(function(e,t){r.vecSweepers[t].putWeights(r.vecThePopulation[t].vecWeights)}),this.sweeperVB=f.map(function(e){return new h(e.x,e.y)}),this.mineVB=g.map(function(e){return new h(e.x,e.y)})}return n(t,[{key:"render",value:function(){var e=this,t="Generation: ".concat(this.iGeneration),n=this.canvas.getContext("2d");if(!n){console.log("no context");return}n.closePath(),n.beginPath(),n.fillStyle="white",n.strokeRect(0,0,this.canvas.width,this.canvas.height),n.fillRect(0,0,this.canvas.width,this.canvas.height),n.fill(),n.strokeStyle="black",n.lineWidth=.5,n.font="13px arial",n.closePath(),n.strokeText(t,5,15),this.fastRender?this.plotStats(n):(this.vecMines.forEach(function(t,i){n.beginPath(),n.strokeStyle="green",n.lineWidth=1;var s=e.mineVB.map(function(e){return new h(e.x,e.y)});e.worldTransform(s,e.vecMines[i]),n.moveTo(s[0].x,s[0].y);for(var r=1;r<s.length;r++)n.lineTo(s[r].x,s[r].y);n.lineTo(s[0].x,s[0].y),n.stroke(),n.closePath()}),this.vecSweepers.forEach(function(t,s){n.beginPath(),n.strokeStyle="red",n.lineWidth=1,s>=i.numElite&&(n.strokeStyle="black");var r=e.sweeperVB.map(function(e){return new h(e.x,e.y)});e.vecSweepers[s].worldTransform(r),n.moveTo(r[0].x,r[0].y);for(var o=1;o<r.length;o++)n.lineTo(r[o].x,r[o].y);n.lineTo(r[0].x,r[0].y),n.stroke(),n.closePath()}))}},{key:"worldTransform",value:function(e,t){var n=new m;n.scale(i.mineScale,i.mineScale),n.translate(t.x,t.y),n.transformPoints(e)}},{key:"plotStats",value:function(e){if(e){var t=this.geneticAlgorithm.averageFitness(),n=this.geneticAlgorithm.bestFitness(),s=this.geneticAlgorithm.getMedianFitness(),r="Best Fitness: ".concat(n),o="Average Fitness: ".concat(t),h="Median Fitness: ".concat(s);e.font="10px arial",e.strokeText(r,5,30),e.strokeText(o,5,45),e.strokeText(h,5,60),e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.moveTo(0,0),e.lineTo(0,i.windowHeight),e.lineTo(i.windowWidth,i.windowHeight),e.stroke(),e.closePath(),e.strokeStyle="red",e.beginPath(),e.moveTo(0,i.windowHeight);for(var a=0;a<=this.vecAvFitness.length;a++)e.lineTo(a*(i.windowWidth/(this.vecAvFitness.length+2)),i.windowHeight-this.vecAvFitness[a]*i.windowHeight/20);e.lineTo(this.vecAvFitness.length*(i.windowWidth/(this.vecAvFitness.length+2)),i.windowHeight-t*i.windowHeight/20),e.stroke(),e.closePath(),e.strokeStyle="blue",e.beginPath(),e.moveTo(0,i.windowHeight);for(var u=0;u<this.vecBestFitness.length;u++)e.lineTo(u*(i.windowWidth/(this.vecBestFitness.length+2)),i.windowHeight-this.vecBestFitness[u]*i.windowHeight/20);e.lineTo(this.vecBestFitness.length*(i.windowWidth/(this.vecBestFitness.length+2)),i.windowHeight-n*i.windowHeight/20),e.stroke(),e.closePath(),e.strokeStyle="green",e.beginPath(),e.moveTo(0,i.windowHeight);for(var c=0;c<this.vecMedianFitness.length;c++)e.lineTo(c*(i.windowWidth/(this.vecMedianFitness.length+2)),i.windowHeight-this.vecMedianFitness[c]*i.windowHeight/20);e.lineTo(this.vecMedianFitness.length*(i.windowWidth/(this.vecMedianFitness.length+2)),i.windowHeight-s*i.windowHeight/20),e.stroke(),e.closePath()}}},{key:"getFastRender",value:function(){return this.fastRender}},{key:"setFastRender",value:function(e){this.fastRender=e}},{key:"fastRenderToggler",value:function(){this.fastRender=!this.fastRender}}]),t}(),y=function(){"use strict";function t(){e(this,t)}return n(t,null,[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}},{key:"pushMessage",value:function(e){t.messageQueue.push(e)}},{key:"popMessage",value:function(){return t.messageQueue.length>0&&t.messageQueue.pop()||""}},{key:"peekMessage",value:function(){return t.messageQueue.length>0?t.messageQueue[t.messageQueue.length-1]:""}}]),t}();y.messageQueue=[],(function(){"use strict";function t(){var n=this;e(this,t),this.done=!1,this.paused=!1,this.loop=function(){for(;""!==y.peekMessage();)t.messageProcesser();(n.controller.getFastRender()||n.timer.readyForNextFrame())&&(n.controller.update()||(console.error("Error in controller update"),n.done=!0),y.pushMessage("paint")),n.done&&y.pushMessage("quit"),n.paused||setTimeout(n.loop,0)},this.paused=!1,this.done=!1,this.timer=new s(i.framesPerSecond),this.controller=new w(this.pause,this.unPause),setTimeout(this.loop,0)}return n(t,[{key:"pause",value:function(){this.paused=!0,confirm("pause")}},{key:"unPause",value:function(){this.paused=!1,this.loop()}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}},{key:"messageProcesser",value:function(){switch(y.popMessage()){case"pause":t.getInstance().pause();break;case"start":t.getInstance().controller=new w(t.getInstance().pause,t.getInstance().unPause);break;case"paint":t.getInstance().controller.render();break;case"quit":t.getInstance().done=!0}}}]),t})().getInstance()}();
//# sourceMappingURL=index.js.map
